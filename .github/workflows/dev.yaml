name: Development workflow
run-name: Development workflow
on: [push]

jobs:
  unit-tests:
    runs-on: self-hosted
    container:
      image: python:3.12-rc-bullseye
    steps:
    - name: Check out repository code
      uses: actions/checkout@v3
    - name: Install pip requirements
      run: |
        pip install -r requirements.txt
    - name: Run unit tests
      run: |
        python3 -m pytest -v
  deploy-to-dev:
    runs-on: self-hosted
    needs: [unit-tests]
    steps:
    - name: Check out repository code
      uses: actions/checkout@v3
    - name: Get deployments
      uses: actions-hub/kubectl@v1.27.3
      env:
        KUBE_CONFIG: ${{ secrets.ACTIONS_DEV_KUBECONFIG }}
      with:
        args: get deploy
